<!doctype html><html lang=zh-hans dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="前言 由于最近开始上Github较多，无意中发现Github推出了一个学生开发者优惠大礼包，这对于囊中羞涩的学生来说真的是大大的福利，给Github一个大大的赞！
这个优惠包里头包含很多开发者需要付费购买的服务或者工具的优惠券，其中有一个DigitalOcean的$50优惠券，对于一直想入一台VPS但又因为价格昂贵望而却步的我来说就是雪中送炭啊，于是我马上注册获取优惠券，随即开始折腾，这里把这两天折腾的过程记录一下。
前期准备 一台运行CentOS 7 x64系统的主机 PuTTY，Windows系统下登录远程主机的工具，一定要去官网下载，一些所谓的汉化版会夹带私货 winSCP，Windows系统下管理远程主机文件的工具，也去官网下载 说明：VPS是必不可少的，(附我的digitalocean推介码，注册即可获赠$10)，PuTTY用来在Windows系统下远程登录VPS，winSCP会用来下载密钥。
Shadowsocks配置 首先使用PuTTY登录到你的VPS，方法就不赘述了，登录后切换到root账户。
安装shadowsocks服务 一步一步执行以下命令，可以复制后在PuTTY中点击鼠标右键粘贴，回车执行，如询问(Y/N)，则输入Y回车。
1 2 3 4 5 yum install epel-release yum update yum install python-setuptools easy_install pip pip install shadowsocks 以上命令执行完之后，shadowsocks已安装到你的VPS中，但还没有运行。
配置shadowsocks服务 运行shadowsocks需要一个配置文件，我们在/etc目录下新建一个配置文件。
1 vi /etc/shadowsocks.json 按键盘i建进入编辑模式，复制以下内容，然后直接右键粘贴。请改“端口号”为你需要的端口号，范围1 ~ 65535，改“你的密码”为你自己的密码。
1 2 3 4 5 6 7 8 9 10 { &amp;#34;server&amp;#34;:&amp;#34;0.0.0.0&amp;#34;, &amp;#34;server_port&amp;#34;:端口号, &amp;#34;local_address&amp;#34;: &amp;#34;127.0.0.1&amp;#34;, &amp;#34;local_port&amp;#34;:1080, &amp;#34;password&amp;#34;:&amp;#34;你的密码&amp;#34;, &amp;#34;timeout&amp;#34;:500, &amp;#34;method&amp;#34;:&amp;#34;aes-256-cfb&amp;#34;, &amp;#34;fast_open&amp;#34;: true } 粘贴后，按键盘Esc键退出编辑模式，输入:wq回车，保存并退出。
上面这些参数应该不用多说了，用shadowsocks的都懂的。
最后一项 fast_open 表示是否使用 TCP_FASTOPEN （后面优化部分会打开系统的TCP_FASTOPEN，所以这里填true，否则填false)"><title>VPS搭建Shadowsocks服务和优化笔记</title><link rel=canonical href=https://i-square.github.io/p/Deploy-and-optimize-Shadowsocks-service-on-VPS/><link rel=stylesheet href=/scss/style.min.8191399262444ab68b72a18c97392f5349be20a1615d77445be51e974c144cff.css><meta property="og:title" content="VPS搭建Shadowsocks服务和优化笔记"><meta property="og:description" content="前言 由于最近开始上Github较多，无意中发现Github推出了一个学生开发者优惠大礼包，这对于囊中羞涩的学生来说真的是大大的福利，给Github一个大大的赞！
这个优惠包里头包含很多开发者需要付费购买的服务或者工具的优惠券，其中有一个DigitalOcean的$50优惠券，对于一直想入一台VPS但又因为价格昂贵望而却步的我来说就是雪中送炭啊，于是我马上注册获取优惠券，随即开始折腾，这里把这两天折腾的过程记录一下。
前期准备 一台运行CentOS 7 x64系统的主机 PuTTY，Windows系统下登录远程主机的工具，一定要去官网下载，一些所谓的汉化版会夹带私货 winSCP，Windows系统下管理远程主机文件的工具，也去官网下载 说明：VPS是必不可少的，(附我的digitalocean推介码，注册即可获赠$10)，PuTTY用来在Windows系统下远程登录VPS，winSCP会用来下载密钥。
Shadowsocks配置 首先使用PuTTY登录到你的VPS，方法就不赘述了，登录后切换到root账户。
安装shadowsocks服务 一步一步执行以下命令，可以复制后在PuTTY中点击鼠标右键粘贴，回车执行，如询问(Y/N)，则输入Y回车。
1 2 3 4 5 yum install epel-release yum update yum install python-setuptools easy_install pip pip install shadowsocks 以上命令执行完之后，shadowsocks已安装到你的VPS中，但还没有运行。
配置shadowsocks服务 运行shadowsocks需要一个配置文件，我们在/etc目录下新建一个配置文件。
1 vi /etc/shadowsocks.json 按键盘i建进入编辑模式，复制以下内容，然后直接右键粘贴。请改“端口号”为你需要的端口号，范围1 ~ 65535，改“你的密码”为你自己的密码。
1 2 3 4 5 6 7 8 9 10 { &amp;#34;server&amp;#34;:&amp;#34;0.0.0.0&amp;#34;, &amp;#34;server_port&amp;#34;:端口号, &amp;#34;local_address&amp;#34;: &amp;#34;127.0.0.1&amp;#34;, &amp;#34;local_port&amp;#34;:1080, &amp;#34;password&amp;#34;:&amp;#34;你的密码&amp;#34;, &amp;#34;timeout&amp;#34;:500, &amp;#34;method&amp;#34;:&amp;#34;aes-256-cfb&amp;#34;, &amp;#34;fast_open&amp;#34;: true } 粘贴后，按键盘Esc键退出编辑模式，输入:wq回车，保存并退出。
上面这些参数应该不用多说了，用shadowsocks的都懂的。
最后一项 fast_open 表示是否使用 TCP_FASTOPEN （后面优化部分会打开系统的TCP_FASTOPEN，所以这里填true，否则填false)"><meta property="og:url" content="https://i-square.github.io/p/Deploy-and-optimize-Shadowsocks-service-on-VPS/"><meta property="og:site_name" content="平方君的后花园"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="VPS"><meta property="article:tag" content="Shadowsocks"><meta property="article:published_time" content="2017-02-28T11:43:59+00:00"><meta property="article:modified_time" content="2017-02-28T11:43:59+00:00"><meta name=twitter:title content="VPS搭建Shadowsocks服务和优化笔记"><meta name=twitter:description content="前言 由于最近开始上Github较多，无意中发现Github推出了一个学生开发者优惠大礼包，这对于囊中羞涩的学生来说真的是大大的福利，给Github一个大大的赞！
这个优惠包里头包含很多开发者需要付费购买的服务或者工具的优惠券，其中有一个DigitalOcean的$50优惠券，对于一直想入一台VPS但又因为价格昂贵望而却步的我来说就是雪中送炭啊，于是我马上注册获取优惠券，随即开始折腾，这里把这两天折腾的过程记录一下。
前期准备 一台运行CentOS 7 x64系统的主机 PuTTY，Windows系统下登录远程主机的工具，一定要去官网下载，一些所谓的汉化版会夹带私货 winSCP，Windows系统下管理远程主机文件的工具，也去官网下载 说明：VPS是必不可少的，(附我的digitalocean推介码，注册即可获赠$10)，PuTTY用来在Windows系统下远程登录VPS，winSCP会用来下载密钥。
Shadowsocks配置 首先使用PuTTY登录到你的VPS，方法就不赘述了，登录后切换到root账户。
安装shadowsocks服务 一步一步执行以下命令，可以复制后在PuTTY中点击鼠标右键粘贴，回车执行，如询问(Y/N)，则输入Y回车。
1 2 3 4 5 yum install epel-release yum update yum install python-setuptools easy_install pip pip install shadowsocks 以上命令执行完之后，shadowsocks已安装到你的VPS中，但还没有运行。
配置shadowsocks服务 运行shadowsocks需要一个配置文件，我们在/etc目录下新建一个配置文件。
1 vi /etc/shadowsocks.json 按键盘i建进入编辑模式，复制以下内容，然后直接右键粘贴。请改“端口号”为你需要的端口号，范围1 ~ 65535，改“你的密码”为你自己的密码。
1 2 3 4 5 6 7 8 9 10 { &amp;#34;server&amp;#34;:&amp;#34;0.0.0.0&amp;#34;, &amp;#34;server_port&amp;#34;:端口号, &amp;#34;local_address&amp;#34;: &amp;#34;127.0.0.1&amp;#34;, &amp;#34;local_port&amp;#34;:1080, &amp;#34;password&amp;#34;:&amp;#34;你的密码&amp;#34;, &amp;#34;timeout&amp;#34;:500, &amp;#34;method&amp;#34;:&amp;#34;aes-256-cfb&amp;#34;, &amp;#34;fast_open&amp;#34;: true } 粘贴后，按键盘Esc键退出编辑模式，输入:wq回车，保存并退出。
上面这些参数应该不用多说了，用shadowsocks的都懂的。
最后一项 fast_open 表示是否使用 TCP_FASTOPEN （后面优化部分会打开系统的TCP_FASTOPEN，所以这里填true，否则填false)"><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-S4LP96619L"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-S4LP96619L",{anonymize_ip:!1})}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu5ad7b3c288b7ec9c6597012c8b723e22_6153_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>💤</span></figure><div class=site-meta><h1 class=site-name><a href=/>平方君的后花园</a></h1><h2 class=site-description>人生苦短，及时行乐。</h2></div></header><ol class=social-menu><li><a href=mailto:i_square@qq.com target=_blank title=E-Mail rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-mail" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 5m0 2a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><path d="M3 7l9 6 9-6"/></svg></a></li><li><a href=https://github.com/i-square target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>主页 | Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>归档 | Archives</span></a></li><li><a href=/categories/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg><span>分类 | Categories</span></a></li><li><a href=/tags/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg><span>标签 | Tags</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>搜索 | Search</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>链接 | Links</span></a></li><li><a href=/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>关于 | About</span></a></li><li><a href=/love target=_blank><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-heart" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19.5 12.572 12 20l-7.5-7.428A5 5 0 1112 6.006a5 5 0 117.5 6.572"/></svg><span>Love Story</span></a></li><div class=menu-bottom-section><li id=i18n-switch><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://i-square.github.io/ selected>中文</option><option value=https://i-square.github.io/en/>English</option></select></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>暗色模式</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#前言>前言</a></li><li><a href=#前期准备>前期准备</a></li><li><a href=#shadowsocks配置>Shadowsocks配置</a><ol><li><a href=#安装shadowsocks服务>安装shadowsocks服务</a></li><li><a href=#配置shadowsocks服务>配置shadowsocks服务</a></li></ol></li><li><a href=#supervisor监控进程>Supervisor监控进程</a><ol><li><a href=#安装supervisor>安装supervisor</a></li><li><a href=#配置supervisor>配置supervisor</a></li><li><a href=#supervisor开机自启>supervisor开机自启</a></li></ol></li><li><a href=#shadowsocks服务优化>Shadowsocks服务优化</a><ol><li><a href=#系统层面>系统层面</a><ol><li><a href=#优化内核参数>优化内核参数</a></li><li><a href=#tcp优化>TCP优化</a></li><li><a href=#开启tcp-fast-open>开启TCP Fast Open</a></li><li><a href=#开启tcp-bbr拥塞控制算法>开启TCP BBR拥塞控制算法</a></li></ol></li><li><a href=#加密层面>加密层面</a><ol><li><a href=#安装m2crypto>安装M2Crypto</a></li><li><a href=#22-安装-gevent>2.2 安装 gevent</a></li><li><a href=#使用chacha20加密算法>使用CHACHA20加密算法</a></li></ol></li><li><a href=#网络层面>网络层面</a><ol><li><a href=#防火墙设置如有>防火墙设置（如有）</a></li></ol></li></ol></li><li><a href=#结语>结语</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E7%AC%94%E8%AE%B0/>笔记</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/Deploy-and-optimize-Shadowsocks-service-on-VPS/>VPS搭建Shadowsocks服务和优化笔记</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Feb 28, 2017</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>阅读时长: 4 分钟</time></div></footer></div></header><section class=article-content><h2 id=前言>前言</h2><p>由于最近开始上Github较多，无意中发现Github推出了一个<a class=link href=https://education.github.com/pack target=_blank rel=noopener>学生开发者优惠大礼包</a>，这对于囊中羞涩的学生来说真的是大大的福利，给Github一个大大的赞！</p><p>这个优惠包里头包含很多开发者需要付费购买的服务或者工具的优惠券，其中有一个<a class=link href=https://www.digitalocean.com/ target=_blank rel=noopener>DigitalOcean</a>的$50优惠券，对于一直想入一台VPS但又因为价格昂贵望而却步的我来说就是雪中送炭啊，于是我马上注册获取优惠券，随即开始折腾，这里把这两天折腾的过程记录一下。</p><h2 id=前期准备>前期准备</h2><ul><li>一台运行CentOS 7 x64系统的主机</li><li><a class=link href=http://www.putty.org/ target=_blank rel=noopener>PuTTY</a>，Windows系统下登录远程主机的工具，一定要去官网下载，一些所谓的汉化版会夹带私货</li><li><a class=link href=https://winscp.net/eng/download.php target=_blank rel=noopener>winSCP</a>，Windows系统下管理远程主机文件的工具，也去官网下载</li></ul><p>说明：VPS是必不可少的，(附<a class=link href="https://www.digitalocean.com/?refcode=ef0a405dfe82" target=_blank rel=noopener>我的digitalocean推介码</a>，注册即可获赠$10)，PuTTY用来在Windows系统下远程登录VPS，winSCP会用来下载密钥。</p><h2 id=shadowsocks配置>Shadowsocks配置</h2><p>首先使用PuTTY登录到你的VPS，方法就不赘述了，登录后切换到root账户。</p><h3 id=安装shadowsocks服务>安装shadowsocks服务</h3><p>一步一步执行以下命令，可以复制后在PuTTY中点击鼠标右键粘贴，回车执行，如询问(Y/N)，则输入Y回车。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yum install epel-release
</span></span><span class=line><span class=cl>yum update
</span></span><span class=line><span class=cl>yum install python-setuptools
</span></span><span class=line><span class=cl>easy_install pip
</span></span><span class=line><span class=cl>pip install shadowsocks
</span></span></code></pre></td></tr></table></div></div><p>以上命令执行完之后，shadowsocks已安装到你的VPS中，但还没有运行。</p><h3 id=配置shadowsocks服务>配置shadowsocks服务</h3><p>运行shadowsocks需要一个配置文件，我们在/etc目录下新建一个配置文件。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi /etc/shadowsocks.json
</span></span></code></pre></td></tr></table></div></div><p>按键盘i建进入编辑模式，复制以下内容，然后直接右键粘贴。请改“端口号”为你需要的端口号，范围1 ~ 65535，改“你的密码”为你自己的密码。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;server&#34;</span><span class=p>:</span><span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;server_port&#34;</span><span class=p>:</span><span class=err>端口号</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;local_address&#34;</span><span class=p>:</span> <span class=s2>&#34;127.0.0.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;local_port&#34;</span><span class=p>:</span><span class=mi>1080</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;password&#34;</span><span class=p>:</span><span class=s2>&#34;你的密码&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;timeout&#34;</span><span class=p>:</span><span class=mi>500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;method&#34;</span><span class=p>:</span><span class=s2>&#34;aes-256-cfb&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;fast_open&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>粘贴后，按键盘Esc键退出编辑模式，输入:wq回车，保存并退出。<br>上面这些参数应该不用多说了，用shadowsocks的都懂的。<br>最后一项 <code>fast_open</code> 表示是否使用 <code>TCP_FASTOPEN</code> （后面优化部分会打开系统的TCP_FASTOPEN，所以这里填true，否则填false)</p><h2 id=supervisor监控进程>Supervisor监控进程</h2><p>配置好shadowsocks之后我们需要后台自启动服务，虽然目前shadowsocks自己也可以后台运行，但是如果有一个监控进程能在shadowsocks进程挂了之后重新启动它就更好了，supervisor就是用来监控进程的工具。</p><h3 id=安装supervisor>安装supervisor</h3><p>运行以下命令</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yum install python-setuptools supervisor
</span></span><span class=line><span class=cl>easy_install supervisor
</span></span></code></pre></td></tr></table></div></div><h3 id=配置supervisor>配置supervisor</h3><p>以上命令执行完之后，supervisor已经安装，然后我们编辑 <code>/etc/supervisord.conf</code> 文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi /etc/supervisord.conf
</span></span></code></pre></td></tr></table></div></div><p>按键盘i建进入编辑模式，光标移到底部空行处，如没空行就在末尾回车加入空行，复制以下内容：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[program:shadowsocks]</span>
</span></span><span class=line><span class=cl><span class=na>command</span><span class=o>=</span><span class=s>ssserver -c /etc/shadowsocks.json</span>
</span></span><span class=line><span class=cl><span class=na>autostart</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl><span class=na>autorestart</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl><span class=na>restartretries</span><span class=o>=</span><span class=s>10</span>
</span></span><span class=line><span class=cl><span class=na>user</span><span class=o>=</span><span class=s>nobody</span>
</span></span></code></pre></td></tr></table></div></div><p>复制完成后，回个车，为底部再留下空行，按键盘Esc键退出编辑模式，输入 <code>:wq</code> 回车，保存并退出。这样就完成了supervisor监控shadowsocks进程的配置，接下来需要让supervisor开机启动，这样才能达到我们的目的。</p><h3 id=supervisor开机自启>supervisor开机自启</h3><p>所幸，CentOS 7下supervisor开机启动非常的容易，<a class=link href=https://github.com/Supervisor/initscripts target=_blank rel=noopener>User-contributed OS init scripts for Supervisor</a>，这个Github项目提供各个系统下的supervisor服务开机启动脚本，其中<a class=link href=https://raw.githubusercontent.com/Supervisor/initscripts/master/centos-systemd-etcs target=_blank rel=noopener>centos-systemd-etcs</a>就是我们需要的CentOS 7下面的脚本。</p><p>建议直接复制脚本内容，然后添加到目录/etc/systemd/system下。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi /etc/systemd/system/supervisord.service
</span></span></code></pre></td></tr></table></div></div><p>按键盘i建进入编辑模式，粘贴脚本内容后按键盘Esc键退出编辑模式，输入:wq回车，保存并退出。<br>然后运行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>systemctl <span class=nb>enable</span> supervisord.service
</span></span></code></pre></td></tr></table></div></div><p>就完成了supervisor的开机启动，到此Shadowsocks已经在CentOS 7 x64下安装配置成功，运行命令</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>reboot
</span></span></code></pre></td></tr></table></div></div><p>重启服务器使服务生效，此时已经可以正常使用Shadowsocks服务。</p><h2 id=shadowsocks服务优化>Shadowsocks服务优化</h2><h3 id=系统层面>系统层面</h3><p>基于kvm架构vps的优化(DO的主机正好可以用)</p><h4 id=优化内核参数>优化内核参数</h4><p><code>vi /etc/sysctl.conf</code> 直接把以下内容复制粘贴进去</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># max open files
</span></span><span class=line><span class=cl>fs.file-max = 1024000
</span></span><span class=line><span class=cl># max read buffer
</span></span><span class=line><span class=cl>net.core.rmem_max = 67108864
</span></span><span class=line><span class=cl># max write buffer
</span></span><span class=line><span class=cl>net.core.wmem_max = 67108864
</span></span><span class=line><span class=cl># default read buffer
</span></span><span class=line><span class=cl>net.core.rmem_default = 65536
</span></span><span class=line><span class=cl># default write buffer
</span></span><span class=line><span class=cl>net.core.wmem_default = 65536
</span></span><span class=line><span class=cl># max processor input queue
</span></span><span class=line><span class=cl>net.core.netdev_max_backlog = 4096
</span></span><span class=line><span class=cl># max backlog
</span></span><span class=line><span class=cl>net.core.somaxconn = 4096
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># resist SYN flood attacks
</span></span><span class=line><span class=cl>net.ipv4.tcp_syncookies = 1
</span></span><span class=line><span class=cl># reuse timewait sockets when safe
</span></span><span class=line><span class=cl>net.ipv4.tcp_tw_reuse = 1
</span></span><span class=line><span class=cl># turn off fast timewait sockets recycling
</span></span><span class=line><span class=cl>net.ipv4.tcp_tw_recycle = 0
</span></span><span class=line><span class=cl># short FIN timeout
</span></span><span class=line><span class=cl>net.ipv4.tcp_fin_timeout = 30
</span></span><span class=line><span class=cl># short keepalive time
</span></span><span class=line><span class=cl>net.ipv4.tcp_keepalive_time = 1200
</span></span><span class=line><span class=cl># outbound port range
</span></span><span class=line><span class=cl>net.ipv4.ip_local_port_range = 10000 65000
</span></span><span class=line><span class=cl># max SYN backlog
</span></span><span class=line><span class=cl>net.ipv4.tcp_max_syn_backlog = 4096
</span></span><span class=line><span class=cl># max timewait sockets held by system simultaneously
</span></span><span class=line><span class=cl>net.ipv4.tcp_max_tw_buckets = 5000
</span></span><span class=line><span class=cl># TCP receive buffer
</span></span><span class=line><span class=cl>net.ipv4.tcp_rmem = 4096 87380 67108864
</span></span><span class=line><span class=cl># TCP write buffer
</span></span><span class=line><span class=cl>net.ipv4.tcp_wmem = 4096 65536 67108864
</span></span><span class=line><span class=cl># turn on path MTU discovery
</span></span><span class=line><span class=cl>net.ipv4.tcp_mtu_probing = 1
</span></span></code></pre></td></tr></table></div></div><p>保存生效 <code>sysctl -p</code></p><hr><h4 id=tcp优化>TCP优化</h4><ol><li>修改文件句柄数限制<ul><li>ubuntu/centos均可修改 <code>/etc/sysctl.conf</code></li><li>找到 <code>fs.file-max</code> 这一行，修改其值为 <code>1024000</code> ，并保存退出。然后执行 <code>sysctl -p</code> 使其生效</li><li>修改 <code>vi /etc/security/limits.conf</code> 文件，加入</li></ul></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>*               soft    nofile           512000
</span></span><span class=line><span class=cl>*               hard    nofile          1024000
</span></span></code></pre></td></tr></table></div></div><p>针对centos,还需要修改 <code>vi /etc/pam.d/common-session</code> 文件，加入 <code>session required pam_limits.so</code></p><ol start=2><li>修改 <code>vi /etc/profile</code> 文件<ul><li>加入 <code>ulimit -SHn 1024000</code></li><li>然后重启服务器执行 <code>ulimit -n</code></li><li>查询返回1024000即可</li></ul></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sysctl.conf报错解决方法
</span></span><span class=line><span class=cl>修复modprobe的：
</span></span><span class=line><span class=cl>rm -f /sbin/modprobe 
</span></span><span class=line><span class=cl>ln -s /bin/true /sbin/modprobe
</span></span><span class=line><span class=cl>修复sysctl的：
</span></span><span class=line><span class=cl>rm -f /sbin/sysctl 
</span></span><span class=line><span class=cl>ln -s /bin/true /sbin/sysctl
</span></span></code></pre></td></tr></table></div></div><hr><p><del>#### 锐速</del><br>锐速官方已不再维护免费版本，目前破解版支持的内核太旧，放弃。</p><hr><h4 id=开启tcp-fast-open>开启TCP Fast Open</h4><p>这个前提条件是需要服务器是Linux 3.7+的内核，如果满足条件，那就在服务端的 <code>vi /etc/sysctl.conf</code> 文件中再加上一行。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># turn on TCP Fast Open on both client and server side
</span></span><span class=line><span class=cl>net.ipv4.tcp_fastopen = 3
</span></span></code></pre></td></tr></table></div></div><p>然后记得把 <code>vi /etc/shadowsocks.json</code> 配置文件中 <code>"fast_open":</code> 配置为 <code>true</code> 这样速度也将会有非常显著的提升。</p><hr><h4 id=开启tcp-bbr拥塞控制算法>开启TCP BBR拥塞控制算法</h4><p>BBR 目的是要尽量跑满带宽, 并且尽量不要有排队的情况, 效果并不比速锐差<br>Linux kernel 4.9 已支持 tcp_bbr 下面简单讲述如何开启</p><ul><li>下载更换内核<br>最新内核查看<a class=link href=http://elrepo.org/linux/kernel/el7/x86_64/RPMS/ target=_blank rel=noopener>这里</a></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
</span></span><span class=line><span class=cl>rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm
</span></span><span class=line><span class=cl>yum --enablerepo<span class=o>=</span>elrepo-kernel install kernel-ml -y
</span></span></code></pre></td></tr></table></div></div><ul><li>查看内核是否安装成功</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>rpm -qa <span class=p>|</span> grep kernel
</span></span></code></pre></td></tr></table></div></div><ul><li>更新 grub 系统引导文件</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>vi /etc/default/grub
</span></span></code></pre></td></tr></table></div></div><p>修改对应的字段为 GRUB_DEFAULT=0，然后重新编译启动项</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>grub2-mkconfig -o /boot/grub2/grub.cfg
</span></span></code></pre></td></tr></table></div></div><ul><li>删除旧内核(可选)</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yum remove kernel  
</span></span></code></pre></td></tr></table></div></div><p>最后重启<code>reboot</code>生效。</p><ul><li><p>注意，某些服务商可能需要首先将VPS配置为可自定义内核，然后grub2的配置才会生效。</p></li><li><p>开启bbr</p></li></ul><p>开机后 <code>uname -r</code> 看看内核是不是最新的，至少要大于4.9</p><p>执行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;net.core.default_qdisc=fq&#34;</span> &gt;&gt; /etc/sysctl.conf
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;net.ipv4.tcp_congestion_control=bbr&#34;</span> &gt;&gt; /etc/sysctl.conf
</span></span></code></pre></td></tr></table></div></div><p>保存生效<br><code>sysctl -p</code></p><p>执行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sysctl net.ipv4.tcp_available_congestion_control
</span></span><span class=line><span class=cl>sysctl net.ipv4.tcp_congestion_control
</span></span></code></pre></td></tr></table></div></div><p>如果结果都有<code>bbr</code>, 则证明你的内核已开启bbr</p><p>执行 <code>lsmod | grep bbr</code><br>看到有 tcp_bbr 模块即说明bbr已启动</p><hr><h3 id=加密层面>加密层面</h3><h4 id=安装m2crypto>安装M2Crypto</h4><p>这个可以提高SS的加密速度，安装办法:<br>先安装依赖包：<br><code>yum install -y openssl-devel gcc swig python-devel autoconf libtool</code><br>安装setuptools:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wget --no-check-certificate https://raw.githubusercontent.com/iMeiji/shadowsocks_install/master/ez_setup.py
</span></span><span class=line><span class=cl>python ez_setup.py install
</span></span></code></pre></td></tr></table></div></div><p>再通过pip安装M2Crypto: <code>pip install M2Crypto</code> 或者 <code>pip install M2Crypto --upgrade</code></p><hr><h4 id=22-安装-gevent>2.2 安装 gevent</h4><p>安装 gevent可以提高 Shadowsocks 的性能。</p><p>CentOS</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>yum install -y libevent
</span></span><span class=line><span class=cl>pip install greenlet
</span></span><span class=line><span class=cl>pip install gevent
</span></span></code></pre></td></tr></table></div></div><hr><h4 id=使用chacha20加密算法>使用CHACHA20加密算法</h4><p>首先，安装libsodium，让系统支持chacha20算法。</p><p>CentOS</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>yum groupinstall &#34;Development Tools&#34;
</span></span><span class=line><span class=cl>wget https://download.libsodium.org/libsodium/releases/LATEST.tar.gz
</span></span><span class=line><span class=cl>tar zxf LATEST.tar.gz
</span></span><span class=line><span class=cl>cd libsodium* 
</span></span><span class=line><span class=cl>./configure
</span></span><span class=line><span class=cl>make
</span></span><span class=line><span class=cl>make install
</span></span><span class=line><span class=cl>vi /etc/ld.so.conf
</span></span><span class=line><span class=cl>添加一行：
</span></span><span class=line><span class=cl>/usr/local/lib
</span></span><span class=line><span class=cl>保存退出后，运行命令：
</span></span><span class=line><span class=cl>ldconfig
</span></span></code></pre></td></tr></table></div></div><p>然后修改ss加密方式: <code>vi /etc/shadowsocks.json</code>
&ldquo;method&rdquo;:&ldquo;aes-256-cfb"改成"method&rdquo;:&ldquo;chacha20&rdquo;.</p><hr><h3 id=网络层面>网络层面</h3><p>此外，选择合适的端口也能优化梯子的速度，广大SS用户的实践经验表明，检查站（GFW）存在一种机制来降低自身的运算压力，即常用的协议端口（如http，smtp，ssh，https，ftp等）的检查较少，所以建议SS绑定这些常用的端口（如：21，22，25，80，443），速度也会有显著提升。<br>如果你还要给小伙伴爬，那我建议开启多个端口而不是共用，这样网络会更加顺畅。</p><h4 id=防火墙设置如有>防火墙设置（如有）</h4><p>自动调整MTU<br><code>iptables -I FORWARD -p tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu</code></p><p>开启 NAT （记得把 eth0 改成自己的网卡名）<br><code>iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE</code></p><p>开启 IPv4 的转发<br><code>sysctl -w net.ipv4.ip_forward=1</code></p><p>打开 443 端口</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>iptables -I INPUT -p tcp --dport 443 -j ACCEPT
</span></span><span class=line><span class=cl>iptables -I INPUT -p udp --dport 443 -j ACCEPT
</span></span></code></pre></td></tr></table></div></div><p>重启防火墙iptables：<br><code>service iptables restart</code></p><hr><h2 id=结语>结语</h2><p>至此，这几天配置shadowsocks的过程便结束了，这里只是将我遇到的情况加以记录，并不能涵盖所有情况，如果碰到其他状况，那么 <code>google</code> 就好了。</p><p>:P</p></section><footer class=article-footer><section class=article-tags><a href=/tags/VPS/>VPS</a>
<a href=/tags/Shadowsocks/>Shadowsocks</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/Common-Ways-to-Enhance-VPS-Security/><div class=article-details><h2 class=article-title>增强VPS安全性的常用方法</h2></div></a></article><article class=has-image><a href=/p/Guide-to-Efficient-Surfing/><div class=article-image><img src=/p/Guide-to-Efficient-Surfing/wave-riding.svg loading=lazy data-key="Guide to Efficient Surfing" data-hash=/p/Guide-to-Efficient-Surfing/wave-riding.svg></div><div class=article-details><h2 class=article-title>高效冲浪指北</h2></div></a></article><article><a href=/p/Solution-to-the-problem-that-OneDriveSetup.exe-eat-CPU/><div class=article-details><h2 class=article-title>OneDriveSetup.exe占用大量CPU的解决办法</h2></div></a></article><article><a href=/p/Summary-of-MFC-BCG-library-static-link-method/><div class=article-details><h2 class=article-title>MFC+BCG库静态链接方法总结</h2></div></a></article><article><a href=/p/Implement-a-simple-timer-class-using-C-11/><div class=article-details><h2 class=article-title>使用C++11实现一个简易计时器类</h2></div></a></article></div></div></aside><div id=cusdis_thread data-host=https://cusdis.com data-app-id=0d2babe1-c058-48ca-a64b-c5afdfa1cb19 data-page-id=12a52f051322265477f0d44e449b1c00 data-page-url=https://i-square.github.io/p/Deploy-and-optimize-Shadowsocks-service-on-VPS/ data-page-title=VPS搭建Shadowsocks服务和优化笔记></div><script async defer src=https://cusdis.com/js/cusdis.es.js></script>
<script>function setCusdisTheme(e){let t=document.querySelector("#cusdis_thread iframe");t&&window.CUSDIS.setTheme(e)}window.addEventListener("onColorSchemeChange",e=>{setCusdisTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2017 -
2023 平方君的后花园</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.16.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>